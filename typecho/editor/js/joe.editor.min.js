$(function(){$("head").append('<meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, shrink-to-fit=no, viewport-fit=cover">'),window.JoeEditor=CodeMirror.fromTextArea(document.querySelector("textarea#text"),{theme:"joe",mode:"gfm",indentUnit:4,lineNumbers:!0,lineWrapping:!0,styleActiveLine:!0,matchBrackets:!0,autoCloseBrackets:!0,autoCloseTags:!0,foldGutter:!0,gutters:["CodeMirror-linenumbers","CodeMirror-foldgutter"],matchTags:{bothTags:!0},extraKeys:{Enter:"newlineAndIndentContinueMarkdownList","Ctrl-J":"toMatchingTag"},selectionPointer:!0}),JoeEditor.setSize("100%","550"),JoeEditor.on("change",function(){});let e=!1;JoeEditor.on("paste",function(t,o){let r=o.clipboardData||window.clipboardData||o.originalEvent.clipboardData;if(!r||!r.items)return;let i=r.items,n=null;if(0===i.length)return;for(let e=0;e<i.length;e++)"file"===i[e].kind&&i[e].type.match(/^image/)&&(o.preventDefault(),n=i[e].getAsFile());if(!n)return;if(e)return;e=!0;let a=JoeUploadURL,s=$('input[name="cid"]').val();s&&(a=a+"&cid="+s);let d=Date.now().toString(36),l=d+".png",c=new FormData;c.append("name",l),c.append("file",n,l),$.ajax({url:a,method:"post",data:c,contentType:!1,processData:!1,xhr:()=>{let e=$.ajaxSettings.xhr();if(e.upload)return $(".CodeMirror-progress").show(),e.upload.addEventListener("progress",e=>{let t=e.loaded/e.total*100;$(".CodeMirror-progress").css("right",-t+"%")},!1),e},success(t){const o=`![${t[1].title}](${t[0]})`;let r=setTimeout(function(){$(".CodeMirror-progress").hide(),$(".CodeMirror-progress").css("right","100%"),e=!1;const t=JoeEditor.getCursor();0===t.ch?JoeEditor.replaceSelection(o):JoeEditor.replaceSelection("\n\n"+o),JoeEditor.focus(),clearTimeout(r)},1e3)},error(){let t=setTimeout(function(){$(".CodeMirror-progress").hide(),$(".CodeMirror-progress").css("right","100%"),e=!1,clearTimeout(t)},1e3)}})}),Typecho.insertFileToEditor=function(e,t,o){const r=o?"!["+e+"]("+t+")":"["+e+"]("+t+")",i=JoeEditor.getCursor(),n=0===i.ch?"":"\n";JoeEditor.replaceSelection(n+r),JoeEditor.focus()}});