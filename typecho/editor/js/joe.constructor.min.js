class JoeInstance{constructor(){this.init()}init(){$(".CodeMirror-wrap").before('<ul class="CodeMirror-means"></ul>'),$(".CodeMirror-wrap").append('<div class="CodeMirror-progress"></div>'),$("body").append('\n            <div class="CodeMirror-dialog">\n                <div class="CodeMirror-dialog__wrapper">\n                    <div class="CodeMirror-dialog__wrapper-header"></div>\n                    <div class="CodeMirror-dialog__wrapper-bodyer"></div>\n                    <div class="CodeMirror-dialog__wrapper-footer">\n                        <button class="CodeMirror-dialog__wrapper-footer--cancle">取消</button>\n                        <button class="CodeMirror-dialog__wrapper-footer--confirm">确定</button>\n                    </div>\n                </div>\n            </div>\n        '),$(".CodeMirror-dialog__wrapper-footer--cancle").on("click",()=>{this.options.cancel(),$(".CodeMirror-dialog").removeClass("active"),$("body").css("overflow","")}),$(".CodeMirror-dialog__wrapper-footer--confirm").on("click",()=>{this.options.confirm(),$(".CodeMirror-dialog").removeClass("active"),$("body").css("overflow","")})}__OpenTheDialog(e={}){const o={title:"提示",innerHtml:"内容",cancel:()=>{},confirm:()=>{}};this.options=Object.assign(o,e),$(".CodeMirror-dialog__wrapper-header").html(this.options.title),$(".CodeMirror-dialog__wrapper-bodyer").html(this.options.innerHtml),$(".CodeMirror-dialog").addClass("active"),$("body").css("overflow","hidden")}initTitleText(e){const o=$(`\n                <li class="CodeMirror-means-item" title="${e.title}">\n                    ${e.icon}\n                    <div class="CodeMirror-means__dropdown">\n                        <div class="CodeMirror-means__dropdown-item" data-text="# "> H1 </div>\n                        <div class="CodeMirror-means__dropdown-item" data-text="## "> H2 </div>\n                        <div class="CodeMirror-means__dropdown-item" data-text="### "> H3 </div>\n                        <div class="CodeMirror-means__dropdown-item" data-text="#### "> H4 </div>\n                        <div class="CodeMirror-means__dropdown-item" data-text="##### "> H5 </div>\n                        <div class="CodeMirror-means__dropdown-item" data-text="###### "> H6 </div>\n                    </div>\n                </li>\n            `);o.on("click",function(e){e.stopPropagation(),$(this).toggleClass("active")}),o.on("click",".CodeMirror-means__dropdown-item",function(e){e.stopPropagation();const t=$(this).attr("data-text"),r=JoeEditor.getCursor();0===r.ch?JoeEditor.replaceSelection(t):JoeEditor.replaceSelection("\n\n"+t),o.removeClass("active"),JoeEditor.focus()}),$(document).on("click",()=>o.removeClass("active")),$(".CodeMirror-means").append(o)}handleFullscreen(e){const o=$(".CodeMirror-means").height(),t=$(`<li class="CodeMirror-means-item" title="${e.title}">${e.icon}</li>`);t.on("click",function(){const e=JoeEditor.getOption("fullScreen");e?(JoeEditor.setOption("fullScreen",!1),$(".CodeMirror-wrap").css("top",""),$(".CodeMirror-means").removeClass("fullscreen"),$(t).removeClass("active")):(JoeEditor.setOption("fullScreen",!0),$(".CodeMirror-wrap").css("top",o),$(".CodeMirror-means").addClass("fullscreen"),$(t).addClass("active"))}),$(".CodeMirror-means").append(t)}insertBoldText(){const e=JoeEditor.getCursor(),o=JoeEditor.getSelection();JoeEditor.replaceSelection("**"+o+"**"),""===o&&JoeEditor.setCursor(e.line,e.ch+2),JoeEditor.focus()}insertItalicText(){const e=JoeEditor.getCursor(),o=JoeEditor.getSelection();JoeEditor.replaceSelection("*"+o+"*"),""===o&&JoeEditor.setCursor(e.line,e.ch+1),JoeEditor.focus()}insertDeleteText(){const e=JoeEditor.getCursor(),o=JoeEditor.getSelection();JoeEditor.replaceSelection("~~"+o+"~~"),""===o&&JoeEditor.setCursor(e.line,e.ch+2),JoeEditor.focus()}insertQuoteText(){const e=JoeEditor.getCursor(),o=JoeEditor.getSelection();0===e.ch?JoeEditor.replaceSelection("> "+o):(JoeEditor.setCursor(e.line,0),JoeEditor.replaceSelection("> "+o),JoeEditor.setCursor(e.line,e.ch+2)),JoeEditor.focus()}insertSpaceText(){JoeEditor.replaceSelection("　"),JoeEditor.focus()}insertCodeInlineText(){const e=JoeEditor.getCursor(),o=JoeEditor.getSelection();JoeEditor.replaceSelection("`"+o+"`"),""===o&&JoeEditor.setCursor(e.line,e.ch+1),JoeEditor.focus()}insertHrText(){const e=JoeEditor.getCursor();0===e.ch?JoeEditor.replaceSelection("\n------------\n\n"):JoeEditor.replaceSelection("\n\n------------\n\n"),JoeEditor.focus()}insertUnorderedListText(){const e=JoeEditor.getCursor(),o=JoeEditor.getSelection();if(0===e.ch)if(""===o)JoeEditor.replaceSelection("- ");else{const e=o.split("\n");for(let o=0,t=e.length;o<t;o++)e[o]=""===e[o]?"":"- "+e[o];JoeEditor.replaceSelection(e.join("\n"))}else if(""===o)JoeEditor.replaceSelection("\n- ");else{const e=o.split("\n");for(let o=0,t=e.length;o<t;o++)e[o]=""===e[o]?"":"- "+e[o];JoeEditor.replaceSelection("\n"+e.join("\n"))}JoeEditor.focus()}insertOrderedListText(){const e=JoeEditor.getCursor(),o=JoeEditor.getSelection();if(0===e.ch)if(""===o)JoeEditor.replaceSelection("1. ");else{const e=o.split("\n");for(let o=0,t=e.length;o<t;o++)e[o]=""===e[o]?"":o+1+". "+e[o];JoeEditor.replaceSelection(e.join("\n"))}else if(""===o)JoeEditor.replaceSelection("\n\n1. ");else{const e=o.split("\n");for(let o=0,t=e.length;o<t;o++)e[o]=""===e[o]?"":o+1+". "+e[o];JoeEditor.replaceSelection("\n"+e.join("\n"))}JoeEditor.focus()}insertTimeText(){const e=new Date,o=e.getFullYear(),t=String(e.getMonth()+1).padStart(2,0),r=String(e.getDate()).padStart(2,0),i=String(e.getHours()).padStart(2,0),n=String(e.getMinutes()).padStart(2,0),l=String(e.getSeconds()).padStart(2,0),d=["星期日","星期一","星期二","星期三","星期四","星期五","星期六"][e.getDay()],a=`${o}-${t}-${r} ${i}:${n}:${l} ${d}`,s=JoeEditor.getCursor();0===s.ch?JoeEditor.replaceSelection(a):JoeEditor.replaceSelection("\n"+a),JoeEditor.focus()}insertLinkText(){this.__OpenTheDialog({title:"插入链接",innerHtml:'\n                <div class="fitem">\n                    <label>链接标题</label>\n                    <input autocomplete="off" name="title" placeholder="请输入链接标题"/>\n                </div>\n                <div class="fitem">\n                    <label>链接地址</label>\n                    <input autocomplete="off" name="url" placeholder="请输入链接地址"/>\n                </div>\n            ',confirm(){const e=$(".CodeMirror-dialog input[name='title']").val(),o=$(".CodeMirror-dialog input[name='url']").val();JoeEditor.replaceSelection(`[${e||"默认标题"}](${o||"默认地址"})`),JoeEditor.focus()}})}insertImageText(){this.__OpenTheDialog({title:"插入图片",innerHtml:'\n                <div class="fitem">\n                    <label>图片名称</label>\n                    <input autocomplete="off" name="title" placeholder="请输入图片名称"/>\n                </div>\n                <div class="fitem">\n                    <label>图片地址</label>\n                    <input autocomplete="off" name="url" placeholder="请输入图片地址"/>\n                </div>\n            ',confirm(){const e=$(".CodeMirror-dialog input[name='title']").val(),o=$(".CodeMirror-dialog input[name='url']").val();JoeEditor.replaceSelection(`![${e||"默认图片"}](${o||"默认地址"})`),JoeEditor.focus()}})}insertTableText(){this.__OpenTheDialog({title:"插入表格",innerHtml:'\n                <div class="fitem">\n                    <label>表格行</label>\n                    <input style="width: 50px; flex: none; margin-right: 10px;" value="3" autocomplete="off" name="row"/>\n                    <label>表格列</label>\n                    <input style="width: 50px; flex: none;" value="3" autocomplete="off" name="column"/>\n                </div>\n            ',confirm(){let e=$(".CodeMirror-dialog input[name='row']").val(),o=$(".CodeMirror-dialog input[name='column']").val();isNaN(e)&&(e=3),isNaN(o)&&(o=3);let t="",r="",i="";for(let e=0;e<o;e++)t+="| 表头 ",r+="| :--: ";for(let t=0;t<e;t++){for(let e=0;e<o;e++)i+="| 表格 ";i+="|\n"}const n=`${t}|\n${r}|\n${i}\n`,l=JoeEditor.getCursor();0===l.ch?JoeEditor.replaceSelection(n):JoeEditor.replaceSelection("\n\n"+n),JoeEditor.focus()}})}insertCodeBlockText(){this.__OpenTheDialog({title:"插入代码块",innerHtml:'\n                <div class="fitem">\n                    <label>语言类型</label>\n                    <input autocomplete="off" name="type" placeholder="请输入语言类型（英文）"/>\n                </div>\n            ',confirm(){const e=$(".CodeMirror-dialog input[name='type']").val(),o=JoeEditor.getCursor(),t=`\`\`\`${e||"html"}\ncode here...\n\`\`\`\n\n`;0===o.ch?JoeEditor.replaceSelection(t):JoeEditor.replaceSelection("\n\n"+t),JoeEditor.focus()}})}handleAbout(){this.__OpenTheDialog({title:"关于",innerHtml:"\n                <ul>\n                    <li>文件读取教程（将文件推拽至编辑器即可）</li>\n                    <li>图片粘贴上传教程（不支持本地文件复制粘贴，支持网络图片复制、截图等）</li>\n                    <li>本编辑器仅为Joe主题使用，未经允许不得移植至其他主题！</li>\n                </ul>\n            "})}}window.JoeInstance=JoeInstance;